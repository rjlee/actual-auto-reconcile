name: Docker Build & Publish

on:
  push:
    branches: [ release ]
  workflow_run:
    workflows: [ 'Release' ]
    types: [ completed ]

permissions:
  contents: read
  packages: write

jobs:
  docker-release:
    if: github.event_name == 'push' || (github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'success')
    uses: rjlee/actual-auto-ci/.github/workflows/docker-release.yml@v1
    with:
      image-name: ghcr.io/${{ github.repository }}
      platforms: linux/amd64,linux/arm64
      dockerfile: Dockerfile
      context: .
